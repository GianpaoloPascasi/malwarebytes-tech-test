import { List, ListItem, ListItemButton, ListItemText } from "@mui/material";
import { Box } from "@mui/system";
import { useEffect } from "react";
import { useDispatch, useSelector } from "react-redux";
import { fetchAllItems } from "../../store/items/items.actions";
import { selectItems } from "../../store/items/items.selectors";
import { uiSliceActions } from "../../store/ui/ui.slice";
import AddItemToOrderDialog, { ADD_ITEM_ORDER_MODAL } from "./AddItemToOrder";
import ItemChangedQuantityDialogContainer from "./ItemChangedQuantityModal";

export default function ItemList() {
  const items = useSelector(selectItems);
  const dispatch = useDispatch();

  useEffect(() => {
    if (items.length === 0) {
      dispatch(fetchAllItems());
    }
  }, [dispatch, items]);

  const showModal = (id: number) => {
    dispatch(
      uiSliceActions.setUiData({
        uiElementName: ADD_ITEM_ORDER_MODAL,
        data: { show: true, id },
      })
    );
  };

  return (
    <Box sx={{ width: "100%" }}>
      <AddItemToOrderDialog />
      <ItemChangedQuantityDialogContainer />
      <List>
        {items.map((item) => (
          <ListItem disablePadding key={item.id}>
            <ListItemButton onClick={() => showModal(item.id)}>
              <ListItemText primary={item.id} />
              <ListItemText
                primary={item.name}
                style={{ textAlign: "start" }}
              />
              <ListItemText
                primary={item.quantity}
                secondary="Quantity left"
                style={{ textAlign: "end" }}
              />
            </ListItemButton>
          </ListItem>
        ))}
      </List>
    </Box>
  );
}
