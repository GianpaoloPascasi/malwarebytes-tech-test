import DialogTitle from "@mui/material/DialogTitle";
import Dialog from "@mui/material/Dialog";
import Typography from "@mui/material/Typography";
import { useDispatch, useSelector } from "react-redux";
import Grid2 from "@mui/material/Unstable_Grid2"; // Grid version 2
import { selectItemById } from "../../store/items/items.selectors";
import { selectUiData } from "../../store/ui/ui.selectors";
import { Item } from "../../store/items/items.slice";
import { Grid } from "@mui/material";
import { Button } from "@mui/material";
import { uiSliceActions } from "../../store/ui/ui.slice";
import { addItemToOrder, removeItemFromOrder } from "../../store/items/items.actions";
import { selectOrder } from "../../store/user/user.selectors";

export interface AddItemToOrderDialogProps {
  open: boolean;
  item: Item;
  onClose: () => void;
  addToCart: () => void;
  removeFromCart: () => void;
}

function AddItemToOrderDialog(props: AddItemToOrderDialogProps) {
  const { onClose, addToCart, removeFromCart, item, open } = props;

  return (
    <Dialog onClose={onClose} open={open} maxWidth="md">
      <DialogTitle>
        {item.id} {item.name}
      </DialogTitle>
      <Grid container padding={1}>
        <Grid xs={8}>
          <Typography>{item.description}</Typography>
        </Grid>
        <Grid xs={4}>
          <Typography>{item.quantity}</Typography>
        </Grid>
        <Grid xs={12} alignItems="flex-end">
          <Button variant="contained" onClick={addToCart}>
            Add to cart
          </Button>
        </Grid>
        <Grid xs={12} alignItems="flex-end">
          <Button variant="contained" color="error" onClick={removeFromCart}>
            Remove from cart
          </Button>
        </Grid>
        <Grid xs={12} alignItems="flex-end">
          <Typography>This items in cart: {0}</Typography>
        </Grid>
      </Grid>
      <Button variant="contained" onClick={onClose}>
        Close
      </Button>
    </Dialog>
  );
}

export const ADD_ITEM_ORDER_MODAL = "addItemModal";

export default function AddItemToOrder() {
  const dialogData = useSelector(selectUiData(ADD_ITEM_ORDER_MODAL));
  const item = useSelector(selectItemById(Number(dialogData?.id)));
  const order = useSelector(selectOrder);
  const dispatch = useDispatch();

  const onClose = () => {
    dispatch(
      uiSliceActions.setUiData({
        uiElementName: ADD_ITEM_ORDER_MODAL,
        data: { show: false },
      })
    );
  };

  const addToCart = () => {
    if (item) {
      dispatch(addItemToOrder(item.id));
    }
  };

  const removeFromCart = () => {
    if (item && order) {
      dispatch(removeItemFromOrder(order.id, item.id));
    }
  };

  return dialogData?.show && item ? (
    <AddItemToOrderDialog
      item={item}
      open={dialogData.show}
      onClose={onClose}
      addToCart={addToCart}
      removeFromCart={removeFromCart}
    />
  ) : null;
}
