import "./App.css";
import { Provider, useDispatch, useSelector } from "react-redux";
import { store } from "./store/store";
import {
  RouterProvider,
  createBrowserRouter,
} from "react-router-dom";
import Login from "./components/user/Login";
import Signup from "./components/user/Signup";
import ItemList from "./components/items/ItemList";
import { useEffect } from "react";
import { USER_ACTIONS } from "./store/user/user.actions";
import { selectIsLoggedIn } from "./store/user/user.selectors";

const router = createBrowserRouter([
  {
    path: "login",
    element: <Login />,
  },
  {
    path: "",
    element: <Login />,
  },
  {
    path: "signup",
    element: <Signup />,
  },
  {
    path: "items",
    element: <ItemList />,
  },
]);

function AppWithProvider() {
  const dispacth = useDispatch();
  const isLoggedIn = useSelector(selectIsLoggedIn);

  useEffect(() => {
    dispacth({ type: USER_ACTIONS.CHECKLOGIN });
    if (
      window.location.pathname !== "/signup" &&
      window.location.pathname !== "/login" &&
      !isLoggedIn
    ) {
      window.location.href = "login";
    }
  }, [dispacth, isLoggedIn]);

  return <RouterProvider router={router} />;
}

function App() {
  return (
    <Provider store={store}>
      <AppWithProvider />
    </Provider>
  );
}

export default App;
