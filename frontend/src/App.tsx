import "./App.css";
import { Provider, useDispatch, useSelector } from "react-redux";
import { store } from "./store/store";
import {
  RouterProvider,
  createBrowserRouter,
} from "react-router-dom";
import Login from "./components/user/Login";
import Signup from "./components/user/Signup";
import ItemList from "./components/items/ItemList";
import { useEffect } from "react";
import { USER_ACTIONS } from "./store/user/user.actions";
import { selectIsLoggedIn, selectTotalItemsInCart } from "./store/user/user.selectors";
import { Grid } from "@mui/material";

const router = createBrowserRouter([
  {
    path: "login",
    element: <Login />,
  },
  {
    path: "",
    element: <Login />,
  },
  {
    path: "signup",
    element: <Signup />,
  },
  {
    path: "items",
    element: <ItemList />,
  },
]);

function AppWithProvider() {
  const dispacth = useDispatch();
  const isLoggedIn = useSelector(selectIsLoggedIn);
  const totalItemsInCart = useSelector(selectTotalItemsInCart);

  useEffect(() => {
    dispacth({ type: USER_ACTIONS.CHECKLOGIN });
    if (
      window.location.pathname !== "/signup" &&
      window.location.pathname !== "/login" &&
      !isLoggedIn
    ) {
      window.location.href = "login";
    }
  }, [dispacth, isLoggedIn]);

  return <>
  <Grid container width={"100%"}>
    <Grid xs={8} item>
      Item list app
    </Grid>
    <Grid xs={4} item>
      Total items in cart: {totalItemsInCart}
    </Grid>
  </Grid>
  <RouterProvider router={router} />
  </>;
}

function App() {
  return (
    <Provider store={store}>
      <AppWithProvider />
    </Provider>
  );
}

export default App;
